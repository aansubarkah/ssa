<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Basang Data: PDF To Excel Table Extractor</title><link rel="icon" type="image/x-icon" href="https://basangdata.com/favicon.ico"><script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><style>*{box-sizing:border-box;margin:0;padding:0}body{font-family:system-ui,-apple-system,sans-serif;background:#f9fafb;color:#374151;line-height:1.5}.container{max-width:64rem;margin:0 auto;padding:2rem 1rem}.card{background:#fff;border-radius:.5rem;box-shadow:0 1px 3px rgba(0,0,0,.1);padding:1.5rem;margin-bottom:1.5rem}.title{font-size:1.875rem;font-weight:700;color:#1f2937;margin-bottom:.5rem}.subtitle{color:#6b7280}.form-group{margin-bottom:1rem}.label{display:block;font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.5rem}.input{width:100%;padding:.75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem}.input:focus{outline:none;ring:2px;ring-color:#3b82f6;border-color:#3b82f6}.btn{padding:.75rem 1.5rem;border:none;border-radius:.375rem;font-weight:500;cursor:pointer;transition:all .2s}.btn-primary{background:#2563eb;color:#fff}.btn-primary:hover{background:#1d4ed8}.btn-primary:disabled{background:#9ca3af;cursor:not-allowed}.btn-success{background:#059669;color:#fff}.btn-success:hover{background:#047857}.btn-purple{background:#7c3aed;color:#fff}.btn-purple:hover{background:#6d28d9}.upload-zone{border:2px dashed #d1d5db;border-radius:.5rem;padding:2rem;text-align:center;color:#6b7280;cursor:pointer}.upload-zone:hover{border-color:#3b82f6;background:#eff6ff}.hidden{display:none}.progress-bar{background:#e5e7eb;height:.5rem;border-radius:.25rem;overflow:hidden}.progress-fill{background:#3b82f6;height:100%;transition:width .3s ease}.grid{display:grid}.grid-3{grid-template-columns:repeat(3,1fr);gap:1rem}.text-center{text-align:center}.text-lg{font-size:1.125rem}.text-sm{font-size:.875rem}.text-xs{font-size:.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.text-green{color:#059669}.text-red{color:#dc2626}.text-yellow{color:#d97706}.text-blue{color:#2563eb}.text-gray{color:#6b7280}.bg-green{background:#dcfce7;color:#166534}.bg-red{background:#fee2e2;color:#991b1b}.bg-yellow{background:#fef3c7;color:#92400e}.bg-gray{background:#f3f4f6}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.p-3{padding:.75rem}.p-4{padding:1rem}.rounded{border-radius:.375rem}.space-y-2>*+*{margin-top:.5rem}.thumbnail{width:100%;height:6rem;object-fit:cover;border-radius:.375rem}.thumbnail-container{position:relative;transition:transform .2s}.thumbnail-container:hover{transform:scale(1.05)}.badge{position:absolute;top:.25rem;right:.25rem;width:1.5rem;height:1.5rem;border-radius:50%;border:2px solid #fff;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700}.badge-pending{background:#d1d5db;color:#6b7280}.badge-processing{background:#f59e0b;animation:pulse 2s infinite}.badge-success{background:#10b981}.badge-error{background:#ef4444}.badge svg{width:1rem;height:1rem;color:#fff}.status-success{background:#dcfce7;border:1px solid #bbf7d0;color:#166534}.status-error{background:#fee2e2;border:1px solid #fecaca;color:#991b1b}.status-warning{background:#fef3c7;border:1px solid #fde68a;color:#92400e}.log{background:#f9fafb;border-radius:.375rem;padding:1rem;max-height:16rem;overflow-y:auto;font-family:monospace;font-size:.875rem}@keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}</style></head><body><div class="container"><div class="card"><h1 class="title">PDF to Excel Table Extractor</h1><p class="subtitle">Upload PDF files and extract tables to Excel format using AI-powered table detection</p></div><div class="card"><h2 class="text-lg font-bold mb-3">API Configuration</h2><div class="form-group"><label class="label">Google AI API Key (<a href="https://aistudio.google.com/apikey" target="_blank" class="text-blue">Get here</a>)</label><input type="password" id="apiKey" class="input" placeholder="Enter your Google AI API key"><div id="apiKeyStatus" class="mt-2 text-sm"></div></div><div style="display:flex;gap:.75rem"><button id="saveApiKey" class="btn btn-primary">Save API Key</button><button id="testApiKey" class="btn btn-success">Test Key</button><button id="clearApiKey" class="btn" style="background:#6b7280;color:#fff">Clear Key</button></div></div><div class="card"><h2 class="text-lg font-bold mb-3">Upload PDF Files</h2><div class="upload-zone" id="uploadZone"><input type="file" id="pdfFiles" multiple accept=".pdf" style="display:none"><svg style="width:3rem;height:3rem;margin:0 auto 1rem;color:#9ca3af" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg><p class="text-lg">Click to select PDF files or drag and drop</p><p class="text-sm text-gray">Multiple files supported</p></div><div id="fileList"></div><div id="thumbnailsContainer"></div></div><div class="card"><h2 class="text-lg font-bold mb-3">Processing Options</h2><div class="form-group"><label class="label">DPI Quality:</label><select id="dpiSelect" class="input" style="width:auto"><option value="150">150 (Fast)</option><option value="200" selected>200 (Balanced)</option><option value="300">300 (High Quality)</option></select></div><button id="processFiles" class="btn btn-success" disabled>Start Processing</button></div><div id="progressSection" class="card hidden"><h2 class="text-lg font-bold mb-3">Processing Progress</h2><div class="mb-3"><div style="display:flex;justify-content:space-between" class="mb-1"><span id="progressText" class="text-sm">Preparing...</span><span id="progressPercent" class="text-sm">0%</span></div><div class="progress-bar"><div id="progressBar" class="progress-fill" style="width:0%"></div></div></div><div id="progressLog" class="log"></div></div><div id="resultsSection" class="card hidden"><h2 class="text-lg font-bold mb-3">Processing Results</h2><div id="resultsList"></div><button id="downloadAll" class="btn btn-purple mt-4 hidden">Download All Excel Files</button></div><div style="text-align:center;padding:2rem 0;color:#6b7280"><p class="text-sm">Made with ❤️ by <a href="https://x.com/basangdataid" target="_blank" class="text-blue font-medium">Basang Data</a></p></div></div><script>class SecureApiStorage{constructor(){this.storageKey='basang_data_api_key';this.encryptionKey='bd_pdf_converter_2024'}encrypt(text){if(!text)return '';let result='';for(let i=0;i<text.length;i++){result+=String.fromCharCode(text.charCodeAt(i)^this.encryptionKey.charCodeAt(i%this.encryptionKey.length))}return btoa(result)}decrypt(encrypted){if(!encrypted)return '';try{const decoded=atob(encrypted);let result='';for(let i=0;i<decoded.length;i++){result+=String.fromCharCode(decoded.charCodeAt(i)^this.encryptionKey.charCodeAt(i%this.encryptionKey.length))}return result}catch(e){return ''}}saveApiKey(apiKey){try{const encrypted=this.encrypt(apiKey);localStorage.setItem(this.storageKey,encrypted);return true}catch(e){console.error('Failed to save API key:',e);return false}}loadApiKey(){try{const encrypted=localStorage.getItem(this.storageKey);return this.decrypt(encrypted)}catch(e){console.error('Failed to load API key:',e);return ''}}async validateApiKey(apiKey){try{const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`,{method:'GET',headers:{'Content-Type':'application/json'}});return response.ok}catch(e){return false}}clearApiKey(){try{localStorage.removeItem(this.storageKey);return true}catch(e){return false}}}pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';const storage=new SecureApiStorage();let apiKey='';let selectedFiles=[];let processedResults=[];let fileThumbnails={};const elements={apiKey:document.getElementById('apiKey'),saveBtn:document.getElementById('saveApiKey'),testBtn:document.getElementById('testApiKey'),clearBtn:document.getElementById('clearApiKey'),status:document.getElementById('apiKeyStatus'),filesInput:document.getElementById('pdfFiles'),uploadZone:document.getElementById('uploadZone'),fileList:document.getElementById('fileList'),thumbnails:document.getElementById('thumbnailsContainer'),processBtn:document.getElementById('processFiles'),progressSection:document.getElementById('progressSection'),progressText:document.getElementById('progressText'),progressPercent:document.getElementById('progressPercent'),progressBar:document.getElementById('progressBar'),progressLog:document.getElementById('progressLog'),resultsSection:document.getElementById('resultsSection'),resultsList:document.getElementById('resultsList'),downloadAllBtn:document.getElementById('downloadAll')};function showStatus(msg,type='info'){const colors={success:'text-green',error:'text-red',warning:'text-yellow',info:'text-blue'};elements.status.innerHTML=`<span class="${colors[type]}">${msg}</span>`}function loadStoredApiKey(){const stored=storage.loadApiKey();if(stored){elements.apiKey.value=stored;apiKey=stored;showStatus('✓ Stored API key loaded','success');updateProcessButton()}}async function saveApiKey(){const key=elements.apiKey.value.trim();if(!key){showStatus('✗ Please enter a valid API key','error');return}if(storage.saveApiKey(key)){apiKey=key;showStatus('✓ API Key saved securely','success');updateProcessButton()}else{showStatus('✗ Failed to save API key','error')}}async function testApiKey(){const key=elements.apiKey.value.trim();if(!key){showStatus('✗ Please enter an API key first','error');return}showStatus('Testing API key...','info');const valid=await storage.validateApiKey(key);if(valid){showStatus('✓ API key is valid and working','success')}else{showStatus('✗ API key is invalid or not working','error')}}function clearApiKey(){if(storage.clearApiKey()){elements.apiKey.value='';apiKey='';showStatus('✓ API key cleared','success');updateProcessButton()}else{showStatus('✗ Failed to clear API key','error')}}async function handleFileSelection(event){selectedFiles=Array.from(event.target.files);displayFileList();await generateThumbnails();updateProcessButton()}function displayFileList(){if(selectedFiles.length===0){elements.fileList.innerHTML='';elements.thumbnails.innerHTML='';return}const html=`<div class="mt-4"><h3 class="font-medium mb-2">Selected Files (${selectedFiles.length}):</h3><div class="space-y-2">${selectedFiles.map(file=>`<div class="p-3 bg-gray rounded"><div class="font-medium">${file.name}</div><div class="text-sm text-gray">${(file.size/1024/1024).toFixed(2)} MB</div></div>`).join('')}</div></div>`;elements.fileList.innerHTML=html}async function generateThumbnails(){elements.thumbnails.innerHTML='<div class="text-center p-4"><div class="animate-spin" style="width:1.5rem;height:1.5rem;border:2px solid #3b82f6;border-top:transparent;border-radius:50%;margin:0 auto"></div><span class="text-sm text-gray mt-2">Generating thumbnails...</span></div>';fileThumbnails={};let allThumbnails=[];for(const file of selectedFiles){try{const thumbnails=await generateFileThumbnails(file);fileThumbnails[file.name]=thumbnails;allThumbnails=allThumbnails.concat(thumbnails.map(thumb=>({...thumb,fileName:file.name})))}catch(error){console.error(`Error generating thumbnails for ${file.name}:`,error)}}displayThumbnails(allThumbnails)}async function generateFileThumbnails(file){const arrayBuffer=await file.arrayBuffer();const pdf=await pdfjsLib.getDocument(arrayBuffer).promise;const thumbnails=[];for(let i=1;i<=pdf.numPages;i++){const page=await pdf.getPage(i);const viewport=page.getViewport({scale:0.5});const canvas=document.createElement('canvas');const context=canvas.getContext('2d');canvas.height=viewport.height;canvas.width=viewport.width;await page.render({canvasContext:context,viewport:viewport}).promise;thumbnails.push({pageNumber:i,dataUrl:canvas.toDataURL('image/jpeg',0.8),status:'pending'})}return thumbnails}function displayThumbnails(thumbnails){if(thumbnails.length===0){elements.thumbnails.innerHTML='';return}const html=`<div style="border-top:1px solid #e5e7eb;padding-top:1rem;margin-top:1rem"><h3 class="font-medium mb-3">Page Thumbnails (${thumbnails.length} pages total):</h3><div class="grid" style="grid-template-columns:repeat(auto-fill,minmax(8rem,1fr));gap:.75rem">${thumbnails.map(thumb=>`<div id="thumb-${thumb.fileName}-${thumb.pageNumber}" class="thumbnail-container"><div style="position:relative;border:2px solid #e5e7eb;border-radius:.375rem;overflow:hidden"><img src="${thumb.dataUrl}" alt="Page ${thumb.pageNumber}" class="thumbnail"><div id="badge-${thumb.fileName}-${thumb.pageNumber}" class="badge badge-pending">${thumb.pageNumber}</div></div><div class="text-center mt-1"><div class="text-xs text-gray" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${thumb.fileName}</div><div class="text-xs text-gray">Page ${thumb.pageNumber}</div></div></div>`).join('')}</div></div>`;elements.thumbnails.innerHTML=html}function updateThumbnailStatus(fileName,pageNumber,status,hasData=false){const badge=document.getElementById(`badge-${fileName}-${pageNumber}`);if(!badge)return;badge.className='badge';switch(status){case 'processing':badge.className+=' badge-processing';badge.innerHTML='<div class="animate-spin" style="width:.75rem;height:.75rem;border:1px solid #fff;border-top:transparent;border-radius:50%"></div>';break;case 'success':if(hasData){badge.className+=' badge-success';badge.innerHTML='<svg class="badge svg" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>'}else{badge.className+=' badge-pending';badge.innerHTML='<svg class="badge svg" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>'}break;case 'error':badge.className+=' badge-error';badge.innerHTML='<svg class="badge svg" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>';break;default:badge.className+=' badge-pending';badge.innerHTML=pageNumber}}function updateProcessButton(){elements.processBtn.disabled=!apiKey||selectedFiles.length===0}async function convertPdfToImages(file,dpi=200){const arrayBuffer=await file.arrayBuffer();const pdf=await pdfjsLib.getDocument(arrayBuffer).promise;const images=[];for(let i=1;i<=pdf.numPages;i++){const page=await pdf.getPage(i);const viewport=page.getViewport({scale:dpi/72});const canvas=document.createElement('canvas');const context=canvas.getContext('2d');canvas.height=viewport.height;canvas.width=viewport.width;await page.render({canvasContext:context,viewport:viewport}).promise;images.push({canvas:canvas,dataUrl:canvas.toDataURL('image/png'),pageNumber:i})}return images}async function extractTableFromImage(imageDataUrl,pageNum,fileName){const base64Data=imageDataUrl.split(',')[1];const prompt=`Analyze this image and extract all table data found on this page. Please: 1. Identify all tables on the page 2. Extract column headers (if any) 3. Extract all row data, preserving the structure 4. If there are multiple tables, combine them or note their separation 5. Include any relevant page information (title, date, etc.) Return the data in the following JSON format: {"headers": ["column1", "column2", "column3"], "rows": [["cell1", "cell2", "cell3"], ["cell4", "cell5", "cell6"]], "page_info": "any additional context about the page"} If no table is found, return empty headers and rows arrays.`;try{const response=await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-lite:generateContent?key='+apiKey,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt},{inline_data:{mime_type:'image/png',data:base64Data}}]}],generationConfig:{temperature:0.2,responseMimeType:'application/json'}})});if(!response.ok){throw new Error(`API Error: ${response.status} ${response.statusText}`)}const data=await response.json();const text=data.candidates[0].content.parts[0].text;return JSON.parse(text)}catch(error){console.error(`Error extracting table from page ${pageNum}:`,error);return null}}function createExcelWorkbook(pdfName,pagesData){const wb=XLSX.utils.book_new();pagesData.forEach((pageData,index)=>{if(pageData&&pageData.rows&&pageData.rows.length>0){const maxColumns=Math.max(pageData.headers?pageData.headers.length:0,...pageData.rows.map(row=>row.length));let headers=pageData.headers||[];if(headers.length<maxColumns){for(let i=headers.length;i<maxColumns;i++){headers.push(`Column_${i+1}`)}}const wsData=[];wsData.push(headers);pageData.rows.forEach(row=>{const paddedRow=[...row];while(paddedRow.length<maxColumns){paddedRow.push('')}paddedRow.push(index+1);paddedRow.push(pdfName);if(pageData.page_info){paddedRow.push(pageData.page_info)}wsData.push(paddedRow)});const finalHeaders=[...headers,'page_number','source_pdf'];if(pageData.page_info){finalHeaders.push('page_info')}wsData[0]=finalHeaders;const ws=XLSX.utils.aoa_to_sheet(wsData);XLSX.utils.book_append_sheet(wb,ws,`Page_${index+1}`)}});return wb}function logProgress(message){const timestamp=new Date().toLocaleTimeString();elements.progressLog.innerHTML+=`<div>[${timestamp}] ${message}</div>`;elements.progressLog.scrollTop=elements.progressLog.scrollHeight}function updateProgress(current,total,message){const percent=Math.round((current/total)*100);elements.progressText.textContent=message;elements.progressPercent.textContent=`${percent}%`;elements.progressBar.style.width=`${percent}%`}async function startProcessing(){if(!apiKey||selectedFiles.length===0)return;elements.processBtn.disabled=true;elements.progressSection.classList.remove('hidden');elements.resultsSection.classList.add('hidden');processedResults=[];elements.progressLog.innerHTML='';const dpi=parseInt(document.getElementById('dpiSelect').value);let totalSteps=0;let currentStep=0;let totalPages=0;let processedPages=0;for(const file of selectedFiles){const arrayBuffer=await file.arrayBuffer();const pdf=await pdfjsLib.getDocument(arrayBuffer).promise;totalSteps+=pdf.numPages+1;totalPages+=pdf.numPages}logProgress(`Starting batch processing of ${selectedFiles.length} PDF files (${totalPages} total pages)...`);for(const file of selectedFiles){logProgress(`Processing: ${file.name}`);updateProgress(currentStep,totalSteps,`Processing ${file.name}...`);try{logProgress(`  Converting PDF to images with DPI: ${dpi}`);const images=await convertPdfToImages(file,dpi);currentStep++;updateProgress(currentStep,totalSteps,`Converting ${file.name} to images...`);logProgress(`  Successfully converted ${images.length} pages`);const pagesData=[];for(const image of images){processedPages++;updateProgress(currentStep,totalSteps,`Processing page ${processedPages} of ${totalPages} (${file.name} - Page ${image.pageNumber})`);updateThumbnailStatus(file.name,image.pageNumber,'processing');logProgress(`    Processing page ${image.pageNumber}...`);const tableData=await extractTableFromImage(image.dataUrl,image.pageNumber,file.name);if(tableData&&tableData.rows&&tableData.rows.length>0){pagesData.push(tableData);logProgress(`      Extracted ${tableData.rows.length} rows`);updateThumbnailStatus(file.name,image.pageNumber,'success',true)}else{logProgress(`      No table data found`);updateThumbnailStatus(file.name,image.pageNumber,'success',false)}currentStep++}if(pagesData.length>0){const wb=createExcelWorkbook(file.name,pagesData);const outputFileName=file.name.replace('.pdf','_by_BasangData.xlsx');processedResults.push({fileName:outputFileName,workbook:wb,originalName:file.name,pagesProcessed:pagesData.length,status:'success'});logProgress(`  Successfully processed ${file.name} - ${pagesData.length} pages with data`)}else{processedResults.push({fileName:file.name,originalName:file.name,status:'no_data'});logProgress(`  No table data found in ${file.name}`)}}catch(error){logProgress(`  Error processing ${file.name}: ${error.message}`);if(fileThumbnails[file.name]){fileThumbnails[file.name].forEach(thumb=>{updateThumbnailStatus(file.name,thumb.pageNumber,'error')})}processedResults.push({fileName:file.name,originalName:file.name,error:error.message,status:'error'})}}updateProgress(totalSteps,totalSteps,'Processing complete!');logProgress('Batch processing complete!');displayResults();elements.processBtn.disabled=false}function displayResults(){elements.resultsSection.classList.remove('hidden');const successful=processedResults.filter(r=>r.status==='success');const failed=processedResults.filter(r=>r.status==='error');const noData=processedResults.filter(r=>r.status==='no_data');let html=`<div class="mb-4 p-4 bg-gray rounded"><h3 class="font-medium mb-2">Summary</h3><div class="grid grid-3 text-center text-sm"><div><div class="text-lg font-bold text-green">${successful.length}</div><div>Successful</div></div><div><div class="text-lg font-bold text-yellow">${noData.length}</div><div>No Data</div></div><div><div class="text-lg font-bold text-red">${failed.length}</div><div>Failed</div></div></div></div>`;if(successful.length>0){html+=`<div class="mb-4"><h3 class="font-medium text-green mb-3">✓ Successfully Processed Files:</h3><div class="space-y-2">${successful.map(result=>`<div class="status-success p-3 rounded" style="display:flex;justify-content:space-between;align-items:center"><div><div class="font-medium">${result.originalName}</div><div class="text-sm">${result.pagesProcessed} pages processed</div></div><button onclick="downloadFile('${result.fileName}')" class="btn btn-success">Download Excel</button></div>`).join('')}</div></div>`}if(noData.length>0){html+=`<div class="mb-4"><h3 class="font-medium text-yellow mb-3">⚠ No Table Data Found:</h3><div class="space-y-2">${noData.map(result=>`<div class="status-warning p-3 rounded"><div class="font-medium">${result.originalName}</div><div class="text-sm">No tables detected in this PDF</div></div>`).join('')}</div></div>`}if(failed.length>0){html+=`<div class="mb-4"><h3 class="font-medium text-red mb-3">✗ Processing Failed:</h3><div class="space-y-2">${failed.map(result=>`<div class="status-error p-3 rounded"><div class="font-medium">${result.originalName}</div><div class="text-sm">Error: ${result.error}</div></div>`).join('')}</div></div>`}elements.resultsList.innerHTML=html;if(successful.length>1){elements.downloadAllBtn.classList.remove('hidden')}}function downloadFile(fileName){const result=processedResults.find(r=>r.fileName===fileName);if(result&&result.workbook){const wbout=XLSX.write(result.workbook,{bookType:'xlsx',type:'array'});const blob=new Blob([wbout],{type:'application/octet-stream'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=fileName;a.click();URL.revokeObjectURL(url)}}function downloadAllFiles(){const successful=processedResults.filter(r=>r.status==='success');successful.forEach(result=>{setTimeout(()=>downloadFile(result.fileName),100)})}elements.saveBtn.addEventListener('click',saveApiKey);elements.testBtn.addEventListener('click',testApiKey);elements.clearBtn.addEventListener('click',clearApiKey);elements.filesInput.addEventListener('change',handleFileSelection);elements.uploadZone.addEventListener('click',()=>elements.filesInput.click());elements.processBtn.addEventListener('click',startProcessing);elements.downloadAllBtn.addEventListener('click',downloadAllFiles);elements.uploadZone.addEventListener('dragover',(e)=>{e.preventDefault();elements.uploadZone.style.borderColor='#3b82f6';elements.uploadZone.style.background='#eff6ff'});elements.uploadZone.addEventListener('dragleave',(e)=>{e.preventDefault();elements.uploadZone.style.borderColor='#d1d5db';elements.uploadZone.style.background=''});elements.uploadZone.addEventListener('drop',async(e)=>{e.preventDefault();elements.uploadZone.style.borderColor='#d1d5db';elements.uploadZone.style.background='';const files=Array.from(e.dataTransfer.files).filter(file=>file.type==='application/pdf');if(files.length>0){const dt=new DataTransfer();files.forEach(file=>dt.items.add(file));elements.filesInput.files=dt.files;selectedFiles=files;displayFileList();await generateThumbnails();updateProcessButton()}});loadStoredApiKey()</script></body></html>